<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Rw7</title>
    <link rel="stylesheet" href="chat-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>
<body>
    <div class="iphone">
        <div class="notch">
            <div class="camera"></div>
            <div class="speaker"></div>
        </div>
        <div class="screen">
            <div class="chat-header">
                <div class="back-button" onclick="goBack()">
                    <i class="fas fa-chevron-right"></i>
                </div>
                <div class="user-info">
                    <h3>Chat Rw7</h3>
                    <span class="status">متصل الآن</span>
                </div>
            </div>
            
            <div class="messages" id="messages">
                <!-- رسالة الترحيب ستضاف هنا تلقائياً -->
            </div>
            
            <div class="input-area">
                <button class="send-button" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
                <input type="text" id="messageInput" placeholder="اكتب رسالة...">
            </div>
        </div>
    </div>

    <script>
        let chatResetTimer;

        function resetChat() {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = ''; // حذف جميع الرسائل
            
            // إضافة رسالة الترحيب من جديد
            setTimeout(() => {
                addMessage("مرحباً بك في Chat Rw7! 👋", 'received');
            }, 500);
        }

        function startChatResetTimer() {
            // إعادة تعيين المؤقت السابق إذا وجد
            if (chatResetTimer) {
                clearTimeout(chatResetTimer);
            }
            // تعيين مؤقت جديد (60000 مللي ثانية = دقيقة واحدة)
            chatResetTimer = setTimeout(resetChat, 60000);
        }

        function addMessage(text, type) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const time = new Date();
            const timeStr = `${time.getHours()}:${time.getMinutes().toString().padStart(2, '0')}`;
            
            messageDiv.innerHTML = `
                <p>${text}</p>
                <span class="time">${timeStr}</span>
            `;
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            // إعادة تشغيل المؤقت عند إضافة رسالة جديدة
            startChatResetTimer();
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (text) {
                // إرسال الرسالة إلى Firebase
                database.ref('messages').push({
                    text: text,
                    timestamp: Date.now(),
                    userId: 'user123' // يجب تغييره بمعرف المستخدم الحقيقي
                });
                
                input.value = '';
            }
        }

        function goBack() {
            window.location.href = 'iphone.html';
        }

        // إضافة رسالة الترحيب عند فتح الشات وبدء المؤقت
        window.onload = function() {
            setTimeout(() => {
                addMessage("مرحباً بك في Chat Rw7! 👋", 'received');
            }, 500);
            startChatResetTimer();
        }

        // إرسال بضغط Enter
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // تهيئة Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBzsQ_TekHdWbe8mM2u4lsvboTPtxBKiSU",
            authDomain: "chatrw7.firebaseapp.com",
            projectId: "chatrw7",
            storageBucket: "chatrw7.firebasestorage.app",
            messagingSenderId: "6083920767",
            appId: "1:6083920767:web:ac25161ac71fd521d1504a",
            measurementId: "G-ZQXJZ5JBNJ"
        };

        // تهيئة Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // الاستماع للرسائل الجديدة
        database.ref('messages').on('child_added', (snapshot) => {
            const message = snapshot.val();
            addMessage(message.text, 'sent');
        });
    </script>
</body>
</html> 